@model testpayment6._0.Areas.admin.Models.OrderTable_manage
@{
    ViewData["Title"] = "Chi tiết đơn đặt bàn #" + Model?.OrderTableId;
    Layout = "~/Areas/admin/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="page-header">
                <h1 class="page-title">Chi tiết đơn đặt bàn #@Model?.OrderTableId</h1>
                <div class="page-options">
                    <a href="@Url.Action("Index")" class="btn btn-secondary">
                        <i class="fa fa-arrow-left"></i> Quay lại
                    </a>
                </div>
            </div>
        </div>
    </div>

    @if (Model == null)
    {
        <div class="row">
            <div class="col-12">
                <div class="alert alert-danger">
                    <h4>Không tìm thấy đơn đặt bàn</h4>
                    <p>Đơn đặt bàn mà bạn đang tìm kiếm không tồn tại hoặc đã bị xóa.</p>
                </div>
            </div>
        </div>
    }
    else
    {
        @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
        {
            <div class="alert alert-danger">
                @ViewBag.ErrorMessage
            </div>
        }

        <!-- Order Information -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Thông tin đơn đặt bàn</h3>
                    </div>
                    <div class="card-body">
                        <table class="table table-borderless">
                            <tr>
                                <th width="40%">ID Đơn:</th>
                                <td><strong>#@Model.OrderTableId</strong></td>
                            </tr>
                            <tr>
                                <th>Người đặt:</th>
                                <td><span class="text-primary">@Model.UserId</span></td>
                            </tr>
                            <tr>
                                <th>Thời gian bắt đầu:</th>
                                <td><span class="text-info">@Model.StartingTime.ToString("dd/MM/yyyy HH:mm")</span></td>
                            </tr>
                            <tr>
                                <th>Ngày đặt:</th>
                                <td><span class="text-muted">@Model.OrderDate.ToString("dd/MM/yyyy HH:mm")</span></td>
                            </tr>
                            <tr>
                                <th>Tổng tiền:</th>
                                <td><strong class="text-success">@Model.TotalPrice.ToString("N0") VNĐ</strong></td>
                            </tr>
                            <tr>
                                <th>Tiền cọc:</th>
                                <td><span class="text-warning">@Model.TotalDeposit.ToString("N0") VNĐ</span></td>
                            </tr>
                            @if (Model.isPaidDeposit == true)
                            {
                                <tr>
                                    <th>Trạng thái thanh toán cọc :</th>
                                    <td><span class="badge bg-success">Đã thanh toán tiền cọc</span></td>
                                </tr>
                            }
                            else
                            {
                                <tr>
                                    <th>Trạng thái thanh toán cọc :</th>
                                    <td><span class="badge bg-danger">Chưa thanh toán tiền cọc</span></td>
                                </tr>
                            }
                            @if (Model.isPaidTotalPrice == true)
                            {
                                <tr>
                                    <th>Trạng thái thanh toán món ăn :</th>
                                    <td><span class="badge bg-success">Đã thanh toán tiền</span></td>
                                </tr>
                            }
                            else
                            {
                                <tr>
                                    <th>Trạng thái thanh toán món ăn :</th>
                                    <td><span class="badge bg-danger">Chưa thanh toán tiền </span></td>
                                </tr>
                            }

                            <tr>
                                <th>Trạng thái:</th>
                                <td>
                                    @if (Model.IsCancel)
                                    {
                                        <span class="badge badge-danger">
                                            <i class="fa fa-times"></i> Đã hủy
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge badge-success">
                                            <i class="fa fa-check"></i> Hoạt động
                                        </span>
                                    }
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Thống kê</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="info-box">
                                    <div class="info-box-icon bg-primary">
                                        <i class="fa fa-table"></i>
                                    </div>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Số bàn đặt</span>
                                        <span class="info-box-number">@Model.OrderTableDetails.Count</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="info-box">
                                    <div class="info-box-icon bg-success">
                                        <i class="fa fa-cutlery"></i>
                                    </div>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Số món ăn</span>
                                        <span class="info-box-number">@Model.OrderFoodDetails.Sum(f => f.Quantity)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <div class="info-box">
                                    <div class="info-box-icon bg-warning">
                                        <i class="fa fa-money"></i>
                                    </div>
                                    <div class="info-box-content">
                                        <span class="info-box-text">Tổng thanh toán</span>
                                        <span class="info-box-number">@((Model.TotalPrice + Model.TotalDeposit).ToString("N0")) VNĐ</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tables Information -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Bàn đã đặt</h3>
                    </div>
                    <div class="card-body">
                        @if (Model.OrderTableDetails.Any())
                        {
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>ID Chi tiết</th>
                                            <th>Số bàn</th>
                                            <th>Trạng thái</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var table in Model.OrderTableDetails)
                                        {
                                            <tr>
                                                <td>@table.OrderTablesDetailsId</td>
                                                <td>
                                                    <span class="badge badge-info">Bàn @table.TableId</span>
                                                </td>
                                                <td>
                                                    <span class="badge badge-success">Đã đặt</span>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-3">
                                <i class="fa fa-table fa-2x text-muted mb-2"></i>
                                <p class="text-muted">Không có thông tin bàn đặt</p>
                            </div>
                        }
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Món ăn đã đặt</h3>
                    </div>
                    <div class="card-body">
                        @if (Model.OrderFoodDetails.Any())
                        {
                            <div class="table-responsive">
                                <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th>Mã món</th>
                                            <th>Số lượng</th>
                                            <th>Đơn giá</th>
                                            <th>Thành tiền</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var food in Model.OrderFoodDetails)
                                        {
                                            <tr>
                                                <td>
                                                    <span class="badge badge-primary">@food.DishId</span>
                                                </td>
                                                <td>
                                                    <span class="text-center">@food.Quantity</span>
                                                </td>
                                                <td>
                                                    <span class="text-success">@food.Price.ToString("N0") VNĐ</span>
                                                </td>
                                                <td>
                                                    <strong class="text-success">@((food.Price * food.Quantity).ToString("N0")) VNĐ</strong>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                    <tfoot>
                                        <tr class="table-warning">
                                            <th colspan="3">Tổng cộng:</th>
                                            <th class="text-success">
                                                @Model.OrderFoodDetails.Sum(f => f.Price * f.Quantity).ToString("N0") VNĐ
                                            </th>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        }
                        else
                        {
                            <div class="text-center py-3">
                                <i class="fa fa-cutlery fa-2x text-muted mb-2"></i>
                                <p class="text-muted">Không có món ăn nào được đặt</p>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Tóm tắt thanh toán</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 offset-md-6">
                                <table class="table table-borderless">
                                    <tr>
                                        <th>Tiền món ăn:</th>
                                        <td class="text-right">@Model.TotalPrice.ToString("N0") VNĐ</td>
                                    </tr>
                                    <tr>
                                        <th>Tiền cọc:</th>
                                        <td class="text-right">@Model.TotalDeposit.ToString("N0") VNĐ</td>
                                    </tr>
                                    <tr class="table-success">
                                        <th>Tổng thanh toán:</th>
                                        <th class="text-right">@((Model.TotalPrice + Model.TotalDeposit).ToString("N0")) VNĐ</th>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .page-title {
        margin: 0;
        color: #333;
    }

    .info-box {
        display: flex;
        align-items: center;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }

    .info-box-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        color: white;
        font-size: 1.5rem;
    }

    .info-box-content {
        flex: 1;
    }

    .info-box-text {
        display: block;
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 0.25rem;
    }

    .info-box-number {
        display: block;
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
    }

    .badge {
        padding: 0.375rem 0.75rem;
        font-size: 0.875rem;
        font-weight: 500;
        border-radius: 0.25rem;
    }

    .badge-primary {
        background-color: #007bff;
        color: white;
    }

    .badge-success {
        background-color: #28a745;
        color: white;
    }

    .badge-info {
        background-color: #17a2b8;
        color: white;
    }

    .badge-warning {
        background-color: #ffc107;
        color: #212529;
    }

    .badge-danger {
        background-color: #dc3545;
        color: white;
    }

    .table-responsive {
        max-height: 400px;
        overflow-y: auto;
    }

    .card {
        border: none;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    }

    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }
</style>