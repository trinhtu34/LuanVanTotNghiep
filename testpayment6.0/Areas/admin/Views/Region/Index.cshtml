@model List<testpayment6._0.Models.Region>
@{
	ViewData["Title"] = "Quản lý khu vực";
	Layout = "~/Areas/admin/Views/Shared/_Layout.cshtml";
}
<div class="container-fluid">
	<div class="row">
		<div class="col-12">
			<div class="d-flex justify-content-between align-items-center mb-3">
				<h2>Quản lý khu vực</h2>
				<a href="@Url.Action("Create")" class="btn btn-primary">
					<i class="fas fa-plus"></i> Thêm khu vực mới
				</a>
			</div>
			@if (TempData["Success"] != null)
			{
				<div class="alert alert-success alert-dismissible fade show" role="alert">
					@TempData["Success"]
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
			}
			@if (ViewBag.Error != null)
			{
				<div class="alert alert-danger alert-dismissible fade show" role="alert">
					@ViewBag.Error
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
			}
			@if (TempData["Error"] != null)
			{
				<div class="alert alert-danger alert-dismissible fade show" role="alert">
					@TempData["Error"]
					<button type="button" class="btn-close" data-bs-dismiss="alert"></button>
				</div>
			}
			<div class="card">
				<div class="card-body">
					@if (Model.Any())
					{
						<div class="table-responsive">
							<table class="table table-striped table-hover">
								<thead class="table-dark">
									<tr>
										<th>ID</th>
										<th>Tên khu vực</th>
										<th style="width: 200px;">Thao tác</th>
									</tr>
								</thead>
								<tbody>
									@foreach (var region in Model)
									{
										<tr>
											<td>@region.RegionId</td>
											<td>@region.RegionName</td>
											<td>
												<a href="@Url.Action("Edit", new { id = region.RegionId })"
												   class="btn btn-sm btn-outline-primary me-2" title="Sửa">
													<i class="fas fa-edit"></i>
												</a>
												<button type="button" class="btn btn-sm btn-outline-danger"
														data-bs-toggle="modal"
														data-bs-target="#deleteModal"
														data-region-id="@region.RegionId"
														data-region-name="@region.RegionName"
														title="Xóa">
													<i class="fas fa-trash"></i>
												</button>
											</td>
										</tr>
									}
								</tbody>
							</table>
						</div>
					}
					else
					{
						<div class="text-center py-4">
							<i class="fas fa-inbox fa-3x text-muted mb-3"></i>
							<p class="text-muted">Chưa có khu vực nào được tạo.</p>
							<a href="@Url.Action("Create")" class="btn btn-primary">Thêm khu vực đầu tiên</a>
						</div>
					}
				</div>
			</div>
		</div>
	</div>
</div>

<!-- Modal xác nhận xóa -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title text-danger" id="deleteModalLabel">
					<i class="fas fa-exclamation-triangle"></i> Xác nhận xóa
				</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<p>Bạn có chắc chắn muốn xóa khu vực <strong id="regionNameToDelete"></strong> không?</p>
				<p class="text-muted small">Hành động này không thể hoàn tác.</p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
				<form id="deleteForm" method="post" class="d-inline">
					@Html.AntiForgeryToken()
					<button type="submit" class="btn btn-danger">
						<i class="fas fa-trash"></i> Xóa
					</button>
				</form>
			</div>
		</div>
	</div>
</div>

<script>
	// Xử lý modal xóa
	document.addEventListener('DOMContentLoaded', function() {
		const deleteModal = document.getElementById('deleteModal');
		const deleteForm = document.getElementById('deleteForm');
		const regionNameSpan = document.getElementById('regionNameToDelete');

		deleteModal.addEventListener('show.bs.modal', function(event) {
			const button = event.relatedTarget;
			const regionId = button.getAttribute('data-region-id');
			const regionName = button.getAttribute('data-region-name');

			// Cập nhật tên khu vực trong modal
			regionNameSpan.textContent = regionName;

			// Cập nhật action của form
			deleteForm.action = '@Url.Action("Delete")' + '/' + regionId;
		});
	});
</script>